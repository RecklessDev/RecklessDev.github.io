---
title: "Implementing a craft tree using XML"
---

<div class="css-full-post-content js-full-post-content">
<p>I hate XML quite a lot. I had the luck of working around some horrible implemented XML based features in the past. Think XMLs that are few thousands line long with DTD or XSD which were outdated and nothing documented properly. But I decided after few hours of brainstorming to go with XML for this feature.</p> <p>The idea was simple, given a base set of <em><strong>elements</strong></em> one should be able to <em><strong>combine</strong></em> them after specific <em><strong>recipes</strong></em> and create <strong><em>complex elements</em></strong>. Think of a tech tree in any RPG; you have wood, metal, wool, cloth and you can create swords, helms, robes, wands or lucky charms. Later you could also have swords that are crafted using other swords or potions which can also be a regent for something else and so on. These I call <strong>items</strong>. Additionally I also defined <strong><em>spells</em></strong> and those are considered to also be a complex element. </p> <p>The behavior I decided to implement? Allow to easily define this crafting tree. </p> <p>Dictionary (as defined in the GDD):</p> <blockquote> <p><strong>elements – </strong>a base regent which can only be used to create complex elements</p> <p><strong>complex element – </strong>the result of a craft combination</p> <p><strong>combine</strong> – the action in which several materials are combined into a complex element</p> <p><strong>recipe – </strong>the list of regents and conditions used to create a complex element</p> <p><strong>spell</strong> – the result of a combination which instead of generating an item will generate a specific effect (fireball, healing spell etc).</p></blockquote> <h3>Defining the XML format</h3> <p>First I created a simple XML file which would model what I actually want to write there. I decided to pick a subset from the specifications and work with that now. Precisely I wanted to define few base elements and few spells. So I wrote the following document:</p> <p><a href="http://lh6.ggpht.com/-eoEB1tYGUrg/U8J0rCyzPXI/AAAAAAAAAYg/WtbQSg20OHY/s1600-h/image%25255B4%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" border="0" alt="image" src="http://lh6.ggpht.com/-aS8HpbhqkbM/U8J0r11kv3I/AAAAAAAAAYo/K_sS_VLY0-8/image_thumb%25255B2%25255D.png?imgmax=800" width="280" height="360"></a></p> <p>I really wanted to first define my entities (available elements, available spells, in the future available items) and only then define how those combine (spell definition and in the future item definition). Writing the XSD to validate this whole thing turned out to be harder than expected and took me about 3 hours.</p> <h3>Using the tech tree in Unity3D</h3> <p>I just love C# and LINQ; this was the most awesome part of the task. All it took to populate the spell recipes in my code was a command like: </p> <p><a href="http://lh3.ggpht.com/-styhVrmhppU/U8J0s529xQI/AAAAAAAAAYw/8XlEYfUdhSg/s1600-h/image%25255B15%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="http://lh5.ggpht.com/-Tzf1DZq52bc/U8J0tU_dW6I/AAAAAAAAAY4/1py7KSWc4Hc/image_thumb%25255B9%25255D.png?imgmax=800" width="537" height="132"></a></p> <p>Now when the user selects three elements from the MATCH 3 table I just have to see if a spell is defined with this specific combination. If it is, as of now it does nothing but in the future will trigger a specific action.</p> <p>&nbsp;</p> <p><strong>Yet to do</strong>:</p> <blockquote> <p>- Extend the XML with item support.</p> <p>- Define combination actions from the XML.</p> <p>- Implement the combination support in Unity.</p></blockquote> <p>I have a feeling that while this might not be the best architecture ever for this kind of project it is simple to implement, use and extend. With a bit of attention I can keep everything modular enough and easily reuse it for future projects.</p> <p>&nbsp;</p> <p><strong>Yet to do on the blog:</strong></p> <p>I just copy-pasted some screenshots of the code but it would be awesome if I manage to find a way to support syntax highlight in my blog posts that would also work from windows live writer. I will reserve some time to research this.</p>  
</div>